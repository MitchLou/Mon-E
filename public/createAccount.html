<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon-e</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="accountPage">
        
        <h2 class="createAccount">Create an Account</h2>

        <label for="firstName">Enter First Name</h3>
        <input type="text" placeholder="First Name" name="firstName" id="firstName" required>

        <br>
        
        
         <label for="lastName">Enter Last Name</h3>
         <input type="text" placeholder="Last Name" name="lastName" id="lastName" required>
        
         <br>
            
        <label for="phonenumber">Enter Phone Number</h3>
            <input type="tel" minlength="10" maxlength="10" id="phoneNumber" name="phonenumber" title="10 digit mobile number" required>
         <br>


        <label for="email">Enter an Email</h3>
        <input type="text" placeholder="Email" name="email" id="email" required>

        <br>
        

        <label for="Password_input">Create a Password</h3>
        <input type="password" placeholder="Password" name="Password_input" id="Password_input" required>

        <br>
      
        <button onclick = "window.location.href = 'signUp.html'" id="back" type="submit">Back</button> 
        <button id="create">Create</button> 
        
    </div>
</body>
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
    import { getDatabase, set, ref } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-database.js";
    import { getAuth, createUserWithEmailAndPassword, sendEmailVerification, onAuthStateChanged  } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-auth.js";
    
    import { firebaseConfig } from "./firebase.js";  

    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);
    document.getElementById("create").addEventListener('click', async () =>{

        const auth = getAuth();

        var FirstName = document.getElementById('firstName').value;
        var LastName = document.getElementById('lastName').value;
        var PhoneNumber = document.getElementById('phoneNumber').value;
        var email = document.getElementById('email').value;
        var password = document.getElementById('Password_input').value;
        
       createUserWithEmailAndPassword(auth, email, password)
        .then((userCredential) => {
            const user = userCredential.user;
            set(ref(database, 'users/' + user.uid),{
                FirstName: FirstName,
                LastName: LastName,
                PhoneNumber: PhoneNumber,
                email: email,
                password: password,
                created_at: Date.now()
            })
            alert('Account Created!')
            sendEmailVerification(user);
            window.location.assign("signUp.html")
        })
        .catch((error) => {
            const errorCode = error.code;
            const errorMessage = error.message;

            console.error('Error signing in:', error.message);
        });
    });

</script>
</html>
